<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">

  <title>College Event Website | Sign Up</title>
  <meta content="" name="description">
  <meta content="" name="keywords">

  <!-- Favicons -->
  <link href="../images/favicon1.ico" rel="icon">

  <!-- Google Fonts -->
  <link
    href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,700,700i|Roboto:100,300,400,500,700|Philosopher:400,400i,700,700i"
    rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="../vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="../vendor/font-awesome/css/font-awesome.min.css" rel="stylesheet">
  <link href="../vendor/modal-video/css/modal-video.min.css" rel="stylesheet">
  <link href="../vendor/owl.carousel/assets/owl.carousel.min.css" rel="stylesheet">
  <link href="../vendor/aos/aos.css" rel="stylesheet">

  <!-- CSS File -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
  <link href="../css/style.css" rel="stylesheet">

  <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
  integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
  crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
  integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
  crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
  integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
  crossorigin="anonymous"></script>
</head>

<body onload="javascript:LoadUniversities()">

  <!-- ======= Header ======= -->
  <header id="header" class="header">
    <div class="container d-flex align-items-center justify-content-between">

      <div id="logo">
        <a href="../index.html"><img src="../images/logo.png" alt="" title="" /></a>
      </div>

      <!-- ======= Nav Bar ======= -->
      <nav id="nav-menu-container">
        <ul class="nav-menu">
          <li><a href="../index.html">Home</a></li>
          <li><a href="about.html">About</a></li>
          <li><a href="contact.html">Contact Us</a></li>
          <li class="menu-active"><a href="signup.html">Sign Up</a></li>
          <li><a href="login.html">Log In</a></li>
        </ul>
      </nav>
      <!-- ======= End Nav Bar ======= -->
    </div>
  </header><!-- End Header -->

  <!-- ======= Sign Up Section ======= -->
  <section id="signup" class="padd-section">

    <div class="container" data-aos="fade-up">

      <div class="section-title text-center">
        <h2>Sign Up</h2>
      </div>

      <div class="row justify-content-center" data-aos="fade-up" data-aos-delay="100">

        <div class="col-lg-5 col-md-8">
          <div class="form">
            <!-- ======= Sign Up Form ======= -->
            <form class="php-email-form" action="">
              <div class="form-group">
                <input type="text" name="firstname" class="form-control" id="firstname" placeholder="First Name"
                  data-rule="minlen:1" data-msg="First name cannot be empty." />
                <div class="validate"></div>
              </div>
              <div class="form-group mt-3">
                <input type="text" name="lastname" class="form-control" id="lastname" placeholder="Last Name"
                  data-rule="minlen:1" data-msg="Last name cannot be empty." />
                <div class="validate"></div>
              </div>

              <div class="form-group">
              <select class="form-control" id="university", placeholder="University">
                <option value="" disabled selected>University Name</option>
              </select>
              </div>

              <div class="form-group mt-3">
                <input type="text" name="uniID" class="form-control" id="uniID" placeholder="ID"
                  data-rule="minlen:1" data-msg="ID cannot be empty." />
                <div class="validate"></div>
              </div>
              <div class="form-group mt-3">
                <input type="email" class="form-control" name="email" id="email" placeholder="Email" data-rule="email"
                  data-msg="Please enter a valid email." />
                <div class="validate"></div>
              </div>
              <div class="form-group mt-3">
                <input type="password" class="form-control" name="password" id="password" placeholder="Password"
                  data-rule="minlen:8" data-msg="Invalid Password. Please enter at least 8 characters." />
                <div class="validate"></div>
              </div>

              <div class="form-group mt-3">
                <input type="password" class="form-control" name="confirmpassword" id="confirmpassword" placeholder="Confirm Password" 
                data-rule ="minlen:8" data-msg="Invalid Password. Please enter at least 8 characters."/>
                <div class="validate"></div>
                <div id="wrongpass"></div>
              </div>

              <div id="success"></div>
              <div id="error"></div>
              <div class="text-center"><button type="submit" onclick="SignUp()">Sign Up</button></div>
            </form>
            <!-- ======= End Sign Up Form ======= -->
          </div>
        </div>
      </div>
    </div>
  </section>
  <!-- ======= End Sign Up Section ======= -->

  <!-- ======= Footer ======= -->
  <footer class="footer">
    <div class="container">
      <div class="row">
        <div class="col-sm-12">
          <div class="footer-logo">
            <a class="navbar-brand" href="#">College Event Website</a>
            <p>Developed for University of Central Florida COP4710 Spring 2021 Term Project: College Event Website
              Application.</p>
            <p>By Elaine Ng, Min Park, and Jeffrey Ramos.</p>
          </div>
        </div>
      </div>
    </div>

    <div class="copyrights">
      <div class="container">
        <p>&copy; Copyrights College Event Website. All rights reserved.</p>
      </div>
    </div>

  </footer>
  <!-- ======= End Footer ======= -->

  <!-- Vendor JS Files -->
  <script src="../vendor/jquery/jquery.min.js"></script>
  <script src="../vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="../vendor/jquery.easing/jquery.easing.min.js"></script>
  <script src="../vendor/php-email-form/validate.js"></script>
  <script src="../vendor/modal-video/js/modal-video.min.js"></script>
  <script src="../vendor/owl.carousel/owl.carousel.min.js"></script>
  <script src="../vendor/superfish/superfish.min.js"></script>
  <script src="../vendor/hoverIntent/hoverIntent.js"></script>
  <script src="../vendor/aos/aos.js"></script>

  <!-- JavaScript File -->
  <script src="../javascript/main.js"></script>
  <script src="../javascript/md5.js"></script>

  <script>

    function LoadUniversities() {
      var xhr = new XMLHttpRequest();
      xhr.open('POST', 'http://localhost/collegewebsite/api/getUni.php', true);
      xhr.setRequestHeader("Content-Type", "application/json");

      xhr.onreadystatechange = function () {
        if (xhr.readyState === 4) {
          if (xhr.status === 200) {
            console.log(this.response);
            var jcontent = JSON.parse(this.response);
			      console.log(jcontent);
			    for (var i = 0; i < jcontent['results'].length; i++) {
            var uni = document.createElement('option');
            uni.id = "university";
            document.getElementById('university').appendChild(uni)
            uni.innerHTML = '<option value="\'' + jcontent['results'][i]['Uni_Name'] + '\'">' + jcontent['results'][i]['Uni_Name'] + '</option>';
          }
            
          }
        }
      };

      xhr.send();
    }

    function SignUp(){
      document.getElementById("wrongpass").innerText = ""
      var firstName = document.getElementById("firstname");
      var lastName = document.getElementById("lastname");
      var university = document.getElementById("university").value;
      var studID = document.getElementById("uniID");
      var email = document.getElementById("email");
      var password = document.getElementById("password");
      var confirmpassword = document.getElementById("confirmpassword");

      if(firstName.value !== "" && lastName.value !== "" && university !== "" && studID.value !== "" && email.value !== "" && password.value !== "" && confirmpassword.value !== ""){
        if(password.value !== confirmpassword.value){
           document.getElementById("wrongpass").innerText = "Passwords do not match."
        } else {
            var hashedpassword = md5(password.value);

            var signupData = {"firstName": firstName.value, "lastName": lastName.value, "university": university, "studID": studID.value, "email": email.value,"password": hashedpassword}
            var jsonSend = JSON.stringify(signupData);
            console.log('JSON SENDING:' + jsonSend);

            var xhr = new XMLHttpRequest();
            xhr.open('POST', 'http://localhost/collegewebsite/api/signup.php', true);
            xhr.setRequestHeader("Content-Type", "application/json");

            xhr.onreadystatechange = function () {
              if (xhr.readyState === 4) {
                if (xhr.status === 200) {
                  var info = JSON.parse(this.responseText);

                  if(info['info'] === "we did it!"){
                    var success = document.getElementById("success");
                        success.innerHTML = '<div class="alert alert-success alert-dismissible fade show" role="alert">Sign up successful! Please Log In.' +
                          '<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button></div>';
                  } else {
                    var error = document.getElementById("error");
                      error.innerHTML = info['info'];
                  }
                }
              }
            };
          
            xhr.send(jsonSend);  
          }
      }  
    }

  </script>

</body>

</html>