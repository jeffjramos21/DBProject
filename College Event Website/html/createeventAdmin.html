<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">

  <title>College Event Website | Create Event</title>
  <meta content="" name="description">
  <meta content="" name="keywords">

  <!-- Favicons -->
  <link href="../images/favicon1.ico" rel="icon">

  <!-- Google Fonts -->
  <link
    href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,700,700i|Roboto:100,300,400,500,700|Philosopher:400,400i,700,700i"
    rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="../vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="../vendor/font-awesome/css/font-awesome.min.css" rel="stylesheet">
  <link href="../vendor/modal-video/css/modal-video.min.css" rel="stylesheet">
  <link href="../vendor/owl.carousel/assets/owl.carousel.min.css" rel="stylesheet">
  <link href="../vendor/aos/aos.css" rel="stylesheet">

  <!-- CSS File -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
  <link href="../css/style.css" rel="stylesheet">

  <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
  integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
  crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
  integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
  crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
  integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
  crossorigin="anonymous"></script>
</head>

<body onload="javascript:GetRSO()">
  <!-- Side Bar-->
  <div id="mySidenav" class="sidenav">
    <div id="logo">
      <a href="../index.html"><img src="../images/logo.png" alt="" title="" /></a>
    </div>
    <a href="admin.html">Dashboard</a>
    <a href="rsoAdminOf.html">Admin RSO</a>
    <a href="rsoAdmin.html">My RSO</a>
    <div id="sidebar-active"><a href="createeventAdmin.html">Create Event</a></div>
    <a href="checkeventsAdmin.html">Check Current Events</a>
    <a href="searchRSOAdmin.html">Search RSO</a>
    <a href="../index.html" onclick="localStorage.clear()">Log Out</a>
  </div>
  <!-- End Side Bar-->

  <!-- ======= Admin - Create Event Section ======= -->
  <section id="createevent" class="padd-section">

    <div class="container">
      <div id="createsuccess"></div>
      <div class="section-title text-center">
        <h2>Create New Event Form</h2>
      </div>

      <div class="row justify-content-center">
        <div class="container">

          <div class="row">
            <div class="col-lg-5 col-md-8">
              <div class="form-group">
                <label for="eventname">Event's Name</label>
                <input type="text" class="form-control" id="eventname" placeholder="Graduation Party">
              </div>

              <div class="row">
                <div class="col-50">
                  <div class="form-group">
                    <label for="eventtype">Event Type</label>
                    <select class="form-control" id="eventtype" onchange="isRSO(this);">
                      <option value="Public">Public</option>
                      <option value="Private">Private</option>
                      <option value="RSO">RSO</option>
                    </select>
                  </div>
                </div>

                <div class="col-50">
                  <div class="form-group">
                    <label for="category">Event Category</label>
                    <select class="form-control" id="category">
                      <option value="Academic">Academic</option>
                      <option value="Career">Career</option>
                      <option value="Concert">Concert</option>
                      <option value="Entertainment">Entertainment</option>
                      <option value="Health">Health</option>
                      <option value="Holiday">Holiday</option>
                      <option value="Information Session">Information Session</option>
                      <option value="Meeting">Meeting</option>
                      <option value="Open Forum">Open Forum</option>
                      <option value="Other">Other</option>
                      <option value="Recreation & Exercise">Recreation & Exercise</option>
                      <option value="Social Event">Social Event</option>
                      <option value="Seminar">Seminar</option>
                      <option value="Sports">Sports</option>
                      <option value="Volunteer">Volunteer</option>
                      <option value="Workshop">Workshop</option>
                    </select>
                  </div>
                </div>
              </div>

              <div id="yesRSO" style="display: none;">
                <div class="row">
                    <div class="form-group">
                      <label for="rsoName">RSO Name</label>
                      <div id="error"></div>
                      <select class="form-control" id="rsoName">
                        <option value="" disabled selected>RSO Name</option>

                        </select>
                      </div>
                      </div> 
              </div>

              <div class="row">
                  <div class="form-group">
                    <label for="eventdate">Event's Date</label>
                    <input type="date" id="eventdate" name="eventdate">
                  </div>
              </div>

              <div class="row">
                <div class="col-50">
                  <div class="form-group">
                    <label for="eventtime">Event Start Time</label>
                    <input type="time" id="starttime" name="starttime">
                  </div>
                </div>

                <div class="col-50">
                  <div class="form-group">
                    <label for="eventtime">Event End Time</label>
                    <input type="time" id="endtime" name="endtime">
                  </div>
                </div>

                </div>
              

              <div class="form-group">
                <label for="eventemail">Contact E-mail</label>
                <input type="email" class="form-control" id="eventemail" placeholder="events@knights.ucf.edu">
              </div>

              <div class="form-group">
                <label for="eventphone">Contact Phone Number</label>
                <input type="tel" class="form-control" id="eventphone" placeholder="407-823-2000">
              </div>

              <div class="form-group">
                <label for="eventdescription">Event's Description</label>
                <textarea class="form-control" id="eventdescription" rows="3" ,
                  placeholder="Graduation Party for Spring 2021!"></textarea>
              </div>
            </div>

            <div class="col-lg-5 col-md-8">
              <div class="form-group">
                <label for="eventaddr">Address</label>
                <input type="text" class="form-control" id="eventaddr" placeholder="4000 Central Florida Blvd">
              </div>

              <div class="row">
                <div class="col-50">
                  <div class="form-group">
                    <label for="eventlat">Latitude</label>
                    <input type="text" id="eventlat" name="eventlat">
                  </div>
                </div>

                <div class="col-50">
                  <div class="form-group">
                    <label for="eventlng">Longitude</label>
                    <input type="text" id="eventlng" name="eventlng">
                  </div>
                </div>
              </div>
              <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAmxPX7Pb3h2-wQ0uPvdG6maJ2sCbrr0RY&callback=initMap" async defer></script>
              <div id="map-canvas"></div>
            </div>
          </div>

          <div id="errormsg"></div>
          <div class="button"><button onClick="createEventSubmit()" type="submit">Submit</button></div>
        </div>
      </div>
    </div>
  </section>
  <!-- ======= End Create Event Section ======= -->

  <!-- Vendor JS Files -->
  <script src="../vendor/jquery/jquery.min.js"></script>
  <script src="../vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="../vendor/jquery.easing/jquery.easing.min.js"></script>
  <script src="../vendor/php-email-form/validate.js"></script>
  <script src="../vendor/modal-video/js/modal-video.min.js"></script>
  <script src="../vendor/owl.carousel/owl.carousel.min.js"></script>
  <script src="../vendor/superfish/superfish.min.js"></script>
  <script src="../vendor/hoverIntent/hoverIntent.js"></script>
  <script src="../vendor/aos/aos.js"></script>

  <!-- JavaScript File -->
  <script src="../javascript/main.js"></script>

  <script>
  var jcontent = {
            "rsoID": [6,7,8],
            "RSO": ["4Ever Knights", "Active Minds", "Actuarial Science Club"]
    }



    const userID = localStorage.getItem('userID');

    function GetRSO() {
      var myRSOdata = { "userID": userID };
      var jsonSend = JSON.stringify(myRSOdata);
      console.log('JSON SENDING:' + jsonSend);

      var xhr = new XMLHttpRequest();
      xhr.open('POST', 'http://localhost/collegewebsite/api/adminRSO.php', true);
      xhr.setRequestHeader("Content-Type", "application/json");

      xhr.onreadystatechange = function () {
        if (xhr.readyState === 4) {
          if (xhr.status === 200) {
            var rso = JSON.parse(this.response);
            console.log(rso);
            if(rso['error'] == null){
              for (var i = 0; i < rso['results'].length; i++) {
                var rsoList = document.createElement('option');
                rsoList.id = "rsoName";
                document.getElementById('rsoName').appendChild(rsoList)
                rsoList.innerHTML = '<option value="\'' + rso['results'][i]['rsoName'] + '\'">' + rso['results'][i]['rsoName']+ '</option>';
              }
            }else {
              var error = document.getElementById("error");
                error.innerHTML = rso['error'];
            }

          }
        }
      };

      xhr.send(jsonSend);
    }

    function createEventSubmit(){
      var error = document.getElementById("errormsg");
      error.innerText = "";
      
      var eventName = document.getElementById("eventname").value;
      var eventType = document.getElementById("eventtype").value;
      var eventCat = document.getElementById("category").value;
      var rsoName = document.getElementById("rsoName").value;
      var date = document.querySelector('input[type="date"]').value;
      var startTime = document.querySelector("#starttime").value;
      var endTime = document.querySelector("#endtime").value;
      var eventEmail = document.getElementById("eventemail").value;
      var eventPhone = document.getElementById("eventphone").value;
      var description = document.getElementById("eventdescription").value;
      var address = document.getElementById("eventaddr").value;
      var lng = document.getElementById("eventlng").value;
      var lat = document.getElementById("eventlat").value;

      if(eventName === "" || date === "" || startTime === "" || eventEmail === "" || eventPhone === "" || description === "" || address === "" ||
         lng === "" || lat === "" || endTime == ""){
          var error = document.getElementById("errormsg");
          error.innerText = "All fields must be filled in."
      } else {
          var createEventData = { "userID": userID, "eventName": eventName, "type": eventType, "rso": rsoName, "category": eventCat, "date": date, "startTime": startTime, 
          "endTime": endTime,"email": eventEmail, "phone": eventPhone, "description": description, "address": address, "lat": lat, "lng": lng}

          var jsonSend = JSON.stringify(createEventData);
          console.log('JSON SENDING:' + jsonSend);

          var xhr = new XMLHttpRequest();
          xhr.open('POST', 'http://localhost/collegewebsite/api/createEvent.php', true);
          xhr.setRequestHeader("Content-Type", "application/json");

          xhr.onreadystatechange = function () {
            if (xhr.readyState === 4) {
              if (xhr.status === 200) {
                var info = JSON.parse(this.response);
                console.log(info);
                if(info['error'] == null){
                  if(info['info'] == "Event Created"){
                  var created = document.getElementById("createsuccess");
                  created.innerHTML = '<div class="alert alert-success alert-dismissible fade show" role="alert">New event has been created.' +
                  '<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button></div>';
                  } else {
                    var created = document.getElementById("createsuccess");
                    created.innerHTML = '<div class="alert alert-success alert-dismissible fade show" role="alert">New event creation has been received.' +
                    '<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button></div>';
                  }
                } else {
                  var error = document.getElementById("error");
                    error.innerHTML = info['error'];
                }

              }
            }
          };

          xhr.send(jsonSend);
      }   
  }

  function initMap() {
  var myOptions = {
      zoom: 15,
      center: new google.maps.LatLng(28.6035671378552, -81.20012833505031)
    },
    map = new google.maps.Map(document.getElementById('map-canvas'), myOptions),
    marker = new google.maps.Marker({map: map,}),
    infowindow = new google.maps.InfoWindow;
    map.addListener('rightclick', function(e) {
    map.setCenter(e.latLng);
    marker.setPosition(e.latLng);
    infowindow.setContent("Latitude: " + e.latLng.lat() +
      "<br>" + "Longitude: " + e.latLng.lng());
    infowindow.open(map, marker);
    var lat = e.latLng.lat();
    var lng = e.latLng.lng();
    document.getElementById("eventlat").value = lat;
    document.getElementById("eventlng").value = lng;
  });
}

function isRSO(that){
  if (that.value == "RSO") {
        document.getElementById("yesRSO").style.display = "block";
    } else {
        document.getElementById("yesRSO").style.display = "none";
    }
}

  </script>

</body>

</html>